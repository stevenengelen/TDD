
<!-- saved from url=(0065)https://www.obeythetestinggoat.com/book/chapter_page_pattern.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.7.1">
<title>The Token Social Bit, the Page Pattern, and an Exercise for the Reader</title>
<link rel="stylesheet" href="./The Token Social Bit, the Page Pattern, and an Exercise for the Reader_files/asciidoctor.css">
<link rel="stylesheet" href="./The Token Social Bit, the Page Pattern, and an Exercise for the Reader_files/font-awesome.min.css">
<link rel="stylesheet" href="./The Token Social Bit, the Page Pattern, and an Exercise for the Reader_files/coderay-asciidoctor.css">
<script async="" src="./The Token Social Bit, the Page Pattern, and an Exercise for the Reader_files/analytics.js"></script><script>var httpRequest = new XMLHttpRequest();
httpRequest.onreadystatechange = function() {
  if (httpRequest.readyState === XMLHttpRequest.DONE) {
    if (httpRequest.status === 200) {
      document.getElementById('header').innerHTML += httpRequest.responseText;
      var subheaders = document.getElementsByClassName('sectlevel2');
      var section;
      for (var i=0; i<subheaders.length; i++) {
        section = subheaders[i];
        if (section.innerHTML.indexOf(window.location.pathname) === -1) {
          section.style.display = 'none';
        } else {
          section.scrollIntoView && section.scrollIntoView();
        }
      }

    }
  }
};
httpRequest.open('GET', 'toc.html');
httpRequest.send();

</script><script src="./The Token Social Bit, the Page Pattern, and an Exercise for the Reader_files/embed.js" data-timestamp="1542135231664"></script><link rel="preload" as="style" href="https://c.disquscdn.com/next/embed/styles/lounge.d49f53e192b9080ef8880a7c9b24f1c3.css"><link rel="preload" as="script" href="https://c.disquscdn.com/next/embed/common.bundle.18932c85febf9520158697cdc31f08ae.js"><link rel="preload" as="script" href="https://c.disquscdn.com/next/embed/lounge.bundle.e7b46487e9e041aabc7c7cff31722578.js"><link rel="preload" as="script" href="https://disqus.com/next/config.js"></head>
<body class="article toc2 toc-left">
<div id="buy_the_book" style="position: absolute; top: 0; right: 0; z-index:100">
  <a href="https://www.obeythetestinggoat.com/pages/book.html">
    <img src="./The Token Social Bit, the Page Pattern, and an Exercise for the Reader_files/buy_the_book.svg" alt="buy the book ribbon">
  </a>
</div>
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="https://www.obeythetestinggoat.com/book/praise.harry.html">Praise for <em>Test-Driven Development with Python</em></a></li>
<li><a href="https://www.obeythetestinggoat.com/book/preface.html">Preface</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/preface.html#_why_i_wrote_a_book_about_test_driven_development">Why I Wrote a Book About Test-Driven Development</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/preface.html#_aims_of_this_book">Aims of This Book</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/preface.html#_outline">Outline</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/preface.html#_conventions_used_in_this_book">Conventions Used in This Book</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/preface.html#_submitting_errata">Submitting Errata</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/preface.html#_using_code_examples">Using Code Examples</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/preface.html#_oreilly_safari">O’Reilly Safari</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/preface.html#_contacting_oreilly">Contacting O’Reilly</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/pre-requisite-installations.html">Prerequisites and Assumptions</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/pre-requisite-installations.html#_python_3_6_and_programming">Python 3.6 and Programming</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/pre-requisite-installations.html#_how_html_works">How HTML Works</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/pre-requisite-installations.html#_django">Django</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/pre-requisite-installations.html#_javascript">JavaScript</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/pre-requisite-installations.html#_required_software_installations">Required Software Installations</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/pre-requisite-installations.html#_setting_up_your_virtualenv">Setting Up Your Virtualenv</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/pre-requisite-installations.html#_installing_django_and_selenium">Installing Django and Selenium</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/pre-requisite-installations.html#_some_error_messages_youre_likely_to_see_when_you_inevitably_fail_to_activate_your_virtualenv">Some Error Messages You’re Likely to See When You <em>Inevitably</em> Fail to Activate Your Virtualenv</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/video_plug.html">Companion Video</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/acknowledgments.html">Acknowledgments</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/acknowledgments.html#_additional_thanks_for_the_second_edition">Additional Thanks for the Second Edition</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/part1.harry.html">The Basics of TDD and Django</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_01.html">1. Getting Django Set Up Using a <span class="keep-together">Functional Test</span></a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/chapter_01.html#_obey_the_testing_goat_do_nothing_until_you_have_a_test">1.1. Obey the Testing Goat! Do Nothing Until You Have a Test</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_01.html#_getting_django_up_and_running">1.2. Getting Django Up and Running</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_01.html#_starting_a_git_repository">1.3. Starting a Git Repository</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_02_unittest.html">2. Extending Our Functional Test Using <span class="keep-together">the unittest Module</span></a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/chapter_02_unittest.html#_using_a_functional_test_to_scope_out_a_minimum_viable_app">2.1. Using a Functional Test to Scope Out a Minimum <span class="keep-together">Viable App</span></a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_02_unittest.html#_the_python_standard_librarys_unittest_module">2.2. The Python Standard Library’s unittest Module</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_02_unittest.html#_commit">2.3. Commit</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_unit_test_first_view.html">3. Testing a Simple Home Page with <span class="keep-together">Unit Tests</span></a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/chapter_unit_test_first_view.html#_our_first_django_app_and_our_first_unit_test">3.1. Our First Django App, and Our First Unit Test</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_unit_test_first_view.html#_unit_tests_and_how_they_differ_from_functional_tests">3.2. Unit Tests, and How They Differ from Functional Tests</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_unit_test_first_view.html#_unit_testing_in_django">3.3. Unit Testing in Django</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_unit_test_first_view.html#_djangos_mvc_urls_and_view_functions">3.4. Django’s MVC, URLs, and View Functions</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_unit_test_first_view.html#_at_last_we_actually_write_some_application_code">3.5. At Last! We Actually Write Some Application Code!</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_unit_test_first_view.html#_urls_py">3.6. urls.py</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_unit_test_first_view.html#_unit_testing_a_view">3.7. Unit Testing a View</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_philosophy_and_refactoring.html">4. What Are We Doing with All These Tests? (And, Refactoring)</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/chapter_philosophy_and_refactoring.html#_programming_is_like_pulling_a_bucket_of_water_up_from_a_well">4.1. Programming Is Like Pulling a Bucket of Water Up <span class="keep-together">from a Well</span></a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_philosophy_and_refactoring.html#_using_selenium_to_test_user_interactions">4.2. Using Selenium to Test User Interactions</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_philosophy_and_refactoring.html#_the_dont_test_constants_rule_and_templates_to_the_rescue">4.3. The “Don’t Test Constants” Rule, and Templates to the Rescue</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_philosophy_and_refactoring.html#_on_refactoring">4.4. On Refactoring</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_philosophy_and_refactoring.html#_a_little_more_of_our_front_page">4.5. A Little More of Our Front Page</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_philosophy_and_refactoring.html#_recap_the_tdd_process">4.6. Recap: The TDD Process</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_post_and_database.html">5. Saving User Input: Testing the Database</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/chapter_post_and_database.html#_wiring_up_our_form_to_send_a_post_request">5.1. Wiring Up Our Form to Send a POST Request</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_post_and_database.html#_processing_a_post_request_on_the_server">5.2. Processing a POST Request on the Server</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_post_and_database.html#_passing_python_variables_to_be_rendered_in_the_template">5.3. Passing Python Variables to Be Rendered in the Template</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_post_and_database.html#_three_strikes_and_refactor">5.4. Three Strikes and Refactor</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_post_and_database.html#_the_django_orm_and_our_first_model">5.5. The Django ORM and Our First Model</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_post_and_database.html#_saving_the_post_to_the_database">5.6. Saving the POST to the Database</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_post_and_database.html#_redirect_after_a_post">5.7. Redirect After a POST</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_post_and_database.html#_rendering_items_in_the_template">5.8. Rendering Items in the Template</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_post_and_database.html#_creating_our_production_database_with_migrate">5.9. Creating Our Production Database with migrate</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_post_and_database.html#_recap">5.10. Recap</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_explicit_waits_1.html">6. Improving Functional Tests: Ensuring Isolation and Removing Voodoo Sleeps</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/chapter_explicit_waits_1.html#_ensuring_test_isolation_in_functional_tests">6.1. Ensuring Test Isolation in Functional Tests</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_explicit_waits_1.html#_aside_upgrading_selenium_and_geckodriver">6.2. Aside: Upgrading Selenium and Geckodriver</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_explicit_waits_1.html#_on_implicit_and_explicit_waits_and_voodoo_time_sleeps">6.3. On Implicit and Explicit Waits, and Voodoo time.sleeps</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_working_incrementally.html">7. Working Incrementally</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/chapter_working_incrementally.html#_small_design_when_necessary">7.1. Small Design When Necessary</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_working_incrementally.html#_implementing_the_new_design_incrementally_using_tdd">7.2. Implementing the New Design Incrementally Using TDD</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_working_incrementally.html#_ensuring_we_have_a_regression_test">7.3. Ensuring We Have a Regression Test</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_working_incrementally.html#_iterating_towards_the_new_design">7.4. Iterating Towards the New Design</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_working_incrementally.html#_taking_a_first_self_contained_step_one_new_url">7.5. Taking a First, Self-Contained Step: One New URL</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_working_incrementally.html#_green_refactor">7.6. Green? Refactor</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_working_incrementally.html#_another_small_step_a_separate_template_for_viewing_lists">7.7. Another Small Step: A Separate Template for Viewing Lists</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_working_incrementally.html#_a_third_small_step_a_url_for_adding_list_items">7.8. A Third Small Step: A URL for Adding List Items</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_working_incrementally.html#_biting_the_bullet_adjusting_our_models">7.9. Biting the Bullet: Adjusting Our Models</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_working_incrementally.html#_each_list_should_have_its_own_url">7.10. Each List Should Have Its Own URL</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_working_incrementally.html#_the_functional_tests_detect_another_regression">7.11. The Functional Tests Detect Another Regression</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_working_incrementally.html#_one_more_view_to_handle_adding_items_to_an_existing_list">7.12. One More View to Handle Adding Items to an Existing List</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_working_incrementally.html#_a_final_refactor_using_url_includes">7.13. A Final Refactor Using URL includes</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/part2.harry.html">Web Development <em>Sine Qua Nons</em></a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_prettification.html">8. Prettification: Layout and Styling, and What to Test About It</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/chapter_prettification.html#_what_to_functionally_test_about_layout_and_style">8.1. What to Functionally Test About Layout and Style</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_prettification.html#_prettification_using_a_css_framework">8.2. Prettification: Using a CSS Framework</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_prettification.html#_django_template_inheritance">8.3. Django Template Inheritance</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_prettification.html#_integrating_bootstrap">8.4. Integrating Bootstrap</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_prettification.html#_static_files_in_django">8.5. Static Files in Django</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_prettification.html#_using_bootstrap_components_to_improve_the_look_of_the_site">8.6. Using Bootstrap Components to Improve the Look of the Site</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_prettification.html#_using_our_own_css">8.7. Using Our Own CSS</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_prettification.html#_what_we_glossed_over_collectstatic_and_other_static_directories">8.8. What We Glossed Over: collectstatic and Other Static Directories</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_javascript.html#_a_few_things_that_didnt_make_it">8.9. A Few Things That Didn’t Make It</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_manual_deployment.html">9. Testing Deployment Using a Staging Site</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/chapter_manual_deployment.html#_tdd_and_the_danger_areas_of_deployment">9.1. TDD and the Danger Areas of Deployment</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_manual_deployment.html#_as_always_start_with_a_test">9.2. As Always, Start with a Test</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_manual_deployment.html#_getting_a_domain_name">9.3. Getting a Domain Name</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_manual_deployment.html#_manually_provisioning_a_server_to_host_our_site">9.4. Manually Provisioning a Server to Host Our Site</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_manual_deployment.html#_deploying_our_code_manually">9.5. Deploying Our Code Manually</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_manual_deployment.html#_debugging_a_deployment_that_doesnt_seem_to_work_at_all">9.6. Debugging a Deployment That Doesn’t Seem to Work at All</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_manual_deployment.html#_hacking_allowed_hosts_in_settings_py">9.7. Hacking ALLOWED_HOSTS in settings.py</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_manual_deployment.html#_creating_the_database_with_migrate">9.8. Creating the Database with migrate</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_manual_deployment.html#_success_our_hack_deployment_works">9.9. Success!  Our Hack Deployment Works</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_making_deployment_production_ready.html">10. Getting to a Production-Ready Deployment</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/chapter_making_deployment_production_ready.html#_what_we_need_to_do">10.1. What We Need to Do</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_making_deployment_production_ready.html#_switching_to_nginx">10.2. Switching to Nginx</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_making_deployment_production_ready.html#_switching_to_gunicorn">10.3. Switching to Gunicorn</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_making_deployment_production_ready.html#_getting_nginx_to_serve_static_files">10.4. Getting Nginx to Serve Static Files</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_making_deployment_production_ready.html#_switching_to_using_unix_sockets">10.5. Switching to Using Unix Sockets</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_making_deployment_production_ready.html#_using_environment_variables_to_adjust_settings_for_production">10.6. Using Environment Variables to Adjust Settings for Production</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_making_deployment_production_ready.html#_essential_googling_the_error_message">10.7. Essential Googling the Error Message</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_making_deployment_production_ready.html#_using_a_env_file_to_store_our_environment_variables">10.8. Using a .env File to Store Our Environment Variables</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_making_deployment_production_ready.html#_using_systemd_to_make_sure_gunicorn_starts_on_boot">10.9. Using Systemd to Make Sure Gunicorn Starts on Boot</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_making_deployment_production_ready.html#_thinking_about_automating">10.10. Thinking About Automating</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_making_deployment_production_ready.html#_saving_our_progress">10.11. Saving Our Progress</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_automate_deployment_with_fabric.html">11. Automating Deployment with Fabric</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/chapter_automate_deployment_with_fabric.html#_breakdown_of_a_fabric_script_for_our_deployment">11.1. Breakdown of a Fabric Script for Our Deployment</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_automate_deployment_with_fabric.html#_trying_it_out">11.2. Trying It Out</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_automate_deployment_with_fabric.html#_provisioning_nginx_and_gunicorn_config_using_sed">11.3. Provisioning: Nginx and Gunicorn Config Using sed</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_automate_deployment_with_fabric.html#_git_tag_the_release">11.4. Git Tag the Release</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_automate_deployment_with_fabric.html#_further_reading">11.5. Further Reading</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_organising_test_files.html">12. Splitting Our Tests into Multiple Files, and a Generic Wait Helper</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/chapter_organising_test_files.html#_start_on_a_validation_ft_preventing_blank_items">12.1. Start on a Validation FT: Preventing Blank Items</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_organising_test_files.html#_a_new_functional_test_tool_a_generic_explicit_wait_helper">12.2. A New Functional Test Tool: A Generic Explicit Wait Helper</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_organising_test_files.html#_finishing_off_the_ft">12.3. Finishing Off the FT</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_organising_test_files.html#_refactoring_unit_tests_into_several_files">12.4. Refactoring Unit Tests into Several Files</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_database_layer_validation.html">13. Validation at the Database Layer</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/chapter_database_layer_validation.html#_model_layer_validation">13.1. Model-Layer Validation</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_database_layer_validation.html#_surfacing_model_validation_errors_in_the_view">13.2. Surfacing Model Validation Errors in the View</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_database_layer_validation.html#_django_pattern_processing_post_requests_in_the_same_view_as_renders_the_form">13.3. Django Pattern: Processing POST Requests in the Same View as Renders the Form</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_database_layer_validation.html#_refactor_removing_hardcoded_urls">13.4. Refactor: Removing Hardcoded URLs</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_simple_form.html">14. A Simple Form</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/chapter_simple_form.html#_moving_validation_logic_into_a_form">14.1. Moving Validation Logic into a Form</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_simple_form.html#_using_the_form_in_our_views">14.2. Using the Form in Our Views</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_simple_form.html#_using_the_form_in_a_view_that_takes_post_requests">14.3. Using the Form in a View That Takes POST Requests</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_simple_form.html#_using_the_form_in_the_other_view">14.4. Using the Form in the Other View</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_simple_form.html#_a_pat_on_the_back">14.5. A Pat on the Back</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_simple_form.html#_but_have_we_wasted_a_lot_of_time">14.6. But Have We Wasted a Lot of Time?</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_simple_form.html#_using_the_forms_own_save_method">14.7. Using the Form’s Own Save Method</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_advanced_forms.html">15. More Advanced Forms</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/chapter_advanced_forms.html#_another_ft_for_duplicate_items">15.1. Another FT for Duplicate Items</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_advanced_forms.html#_experimenting_with_duplicate_item_validation_at_the_views_layer">15.2. Experimenting with Duplicate Item Validation at the Views Layer</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_advanced_forms.html#_a_more_complex_form_to_handle_uniqueness_validation">15.3. A More Complex Form to Handle Uniqueness Validation</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_advanced_forms.html#_using_the_existing_list_item_form_in_the_list_view">15.4. Using the Existing List Item Form in the List View</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_advanced_forms.html#_wrapping_up_what_weve_learned_about_testing_django">15.5. Wrapping Up: What We’ve Learned About Testing Django</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_javascript.html">16. Dipping Our Toes, Very Tentatively, <span class="keep-together">into JavaScript</span></a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/chapter_javascript.html#_starting_with_an_ft">16.1. Starting with an FT</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_javascript.html#_setting_up_a_basic_javascript_test_runner">16.2. Setting Up a Basic JavaScript Test Runner</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_javascript.html#_using_jquery_and_the_fixtures_div">16.3. Using jQuery and the Fixtures Div</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_javascript.html#_building_a_javascript_unit_test_for_our_desired_functionality">16.4. Building a JavaScript Unit Test for Our Desired Functionality</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_javascript.html#_fixtures_execution_order_and_global_state_key_challenges_of_js_testing">16.5. Fixtures, Execution Order, and Global State: Key Challenges of JS Testing</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_javascript.html#_columbo_says_onload_boilerplate_and_namespacing">16.6. Columbo Says: Onload Boilerplate and Namespacing</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_javascript.html#_javascript_testing_in_the_tdd_cycle">16.7. JavaScript Testing in the TDD Cycle</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_page_pattern.html#_a_few_things_that_didnt_make_it_2">16.8. A Few Things That Didn’t Make It</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_deploying_validation.html">17. Deploying Our New Code</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/chapter_deploying_validation.html#_staging_deploy">17.1. Staging Deploy</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_deploying_validation.html#_live_deploy">17.2. Live Deploy</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_deploying_validation.html#_what_to_do_if_you_see_a_database_error">17.3. What to Do If You See a Database Error</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_deploying_validation.html#_wrap_up_git_tag_the_new_release">17.4. Wrap-Up: git tag the New Release</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/part3.harry.html">More Advanced Topics in Testing</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_spiking_custom_auth.html">18. User Authentication, Spiking, and <span class="keep-together">De-Spiking</span></a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/chapter_spiking_custom_auth.html#_passwordless_auth">18.1. Passwordless Auth</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_spiking_custom_auth.html#_exploratory_coding_aka_spiking">18.2. Exploratory Coding, aka "Spiking"</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_spiking_custom_auth.html#_de_spiking">18.3. De-spiking</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_spiking_custom_auth.html#_a_minimal_custom_user_model">18.4. A Minimal Custom User Model</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_spiking_custom_auth.html#_a_token_model_to_link_emails_with_a_unique_id">18.5. A Token Model to Link Emails with a Unique ID</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_mocking.html">19. Using Mocks to Test External Dependencies or Reduce Duplication</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/chapter_mocking.html#_before_we_start_getting_the_basic_plumbing_in">19.1. Before We Start: Getting the Basic Plumbing In</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_mocking.html#_mocking_manually_aka_monkeypatching">19.2. Mocking Manually, aka Monkeypatching</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_mocking.html#_the_python_mock_library">19.3. The Python Mock Library</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_mocking.html#_de_spiking_our_custom_authentication_backend">19.4. De-spiking Our Custom Authentication Backend</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_mocking.html#_an_alternative_reason_to_use_mocks_reducing_duplication">19.5. An Alternative Reason to Use Mocks: Reducing Duplication</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_mocking.html#_the_moment_of_truth_will_the_ft_pass">19.6. The Moment of Truth:  Will the FT Pass?</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_mocking.html#_it_works_in_theory_does_it_work_in_practice">19.7. It Works in Theory!  Does It Work in Practice?</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_mocking.html#_finishing_off_our_ft_testing_logout">19.8. Finishing Off Our FT, Testing Logout</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_fixtures_and_wait_decorator.html">20. Test Fixtures and a Decorator for <span class="keep-together">Explicit Waits</span></a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/chapter_fixtures_and_wait_decorator.html#_skipping_the_login_process_by_pre_creating_a_session">20.1. Skipping the Login Process by Pre-creating a Session</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_fixtures_and_wait_decorator.html#_our_final_explicit_wait_helper_a_wait_decorator">20.2. Our Final Explicit Wait Helper: A Wait Decorator</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_server_side_debugging.html">21. Server-Side Debugging</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/chapter_server_side_debugging.html#_the_proof_is_in_the_pudding_using_staging_to_catch_final_bugs">21.1. The Proof Is in the Pudding: Using Staging to Catch Final Bugs</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_server_side_debugging.html#_inspecting_logs_on_the_server">21.2. Inspecting Logs on the Server</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_server_side_debugging.html#_another_environment_variable">21.3. Another Environment Variable</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_server_side_debugging.html#_adapting_our_ft_to_be_able_to_test_real_emails_via_pop3">21.4. Adapting Our FT to Be Able to Test Real Emails via POP3</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_server_side_debugging.html#_managing_the_test_database_on_staging">21.5. Managing the Test Database on Staging</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_server_side_debugging.html#_updating_our_deploy_script">21.6. Updating our Deploy Script</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_server_side_debugging.html#_wrap_up">21.7. Wrap-Up</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_outside_in.html">22. Finishing "My Lists": Outside-In TDD</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/chapter_outside_in.html#_the_alternative_inside_out">22.1. The Alternative: "Inside-Out"</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_outside_in.html#_why_prefer_outside_in">22.2. Why Prefer "Outside-In"?</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_outside_in.html#_the_ft_for_my_lists">22.3. The FT for "My Lists"</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_outside_in.html#_the_outside_layer_presentation_and_templates">22.4. The Outside Layer: Presentation and Templates</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_outside_in.html#_moving_down_one_layer_to_view_functions_the_controller">22.5. Moving Down One Layer to View Functions (the Controller)</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_outside_in.html#_another_pass_outside_in">22.6. Another Pass, Outside-In</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_outside_in.html#_the_next_requirement_from_the_views_layer_new_lists_should_record_owner">22.7. The Next "Requirement" from the Views Layer: New Lists Should Record Owner</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_outside_in.html#_moving_down_to_the_model_layer">22.8. Moving Down to the Model Layer</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_purist_unit_tests.html">23. Test Isolation, and "Listening to Your Tests"</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/chapter_purist_unit_tests.html#_revisiting_our_decision_point_the_views_layer_depends_on_unwritten_models_code">23.1. Revisiting Our Decision Point: The Views Layer Depends on Unwritten Models Code</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_purist_unit_tests.html#_a_first_attempt_at_using_mocks_for_isolation">23.2. A First Attempt at Using Mocks for Isolation</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_purist_unit_tests.html#_listen_to_your_tests_ugly_tests_signal_a_need_to_refactor">23.3. Listen to Your Tests: Ugly Tests Signal a Need to Refactor</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_purist_unit_tests.html#_rewriting_our_tests_for_the_view_to_be_fully_isolated">23.4. Rewriting Our Tests for the View to Be Fully Isolated</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_purist_unit_tests.html#_moving_down_to_the_forms_layer">23.5. Moving Down to the Forms Layer</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_purist_unit_tests.html#_finally_moving_down_to_the_models_layer">23.6. Finally, Moving Down to the Models Layer</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_purist_unit_tests.html#_the_moment_of_truth_and_the_risks_of_mocking">23.7. The Moment of Truth (and the Risks of Mocking)</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_purist_unit_tests.html#_thinking_of_interactions_between_layers_as_contracts">23.8. Thinking of Interactions Between Layers as "Contracts"</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_purist_unit_tests.html#_one_more_test">23.9. One More Test</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_purist_unit_tests.html#_tidy_up_what_to_keep_from_our_integrated_test_suite">23.10. Tidy Up: What to Keep from Our Integrated Test Suite</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_purist_unit_tests.html#_conclusions_when_to_write_isolated_versus_integrated_tests">23.11. Conclusions: When to Write Isolated Versus Integrated Tests</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_CI.html">24. Continuous Integration (CI)</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/chapter_CI.html#_installing_jenkins">24.1. Installing Jenkins</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_CI.html#_configuring_jenkins">24.2. Configuring Jenkins</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_CI.html#_setting_up_our_project">24.3. Setting Up Our Project</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_CI.html#_first_build">24.4. First Build!</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_CI.html#_setting_up_a_virtual_display_so_the_fts_can_run_headless">24.5. Setting Up a Virtual Display So the FTs Can Run Headless</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_CI.html#_taking_screenshots">24.6. Taking Screenshots</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_CI.html#_if_in_doubt_try_bumping_the_timeout">24.7. If in Doubt, Try Bumping the Timeout!</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_CI.html#_running_our_qunit_javascript_tests_in_jenkins_with_phantomjs">24.8. Running Our QUnit JavaScript Tests in Jenkins with PhantomJS</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_CI.html#_more_things_to_do_with_a_ci_server">24.9. More Things to Do with a CI Server</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_page_pattern.html">25. The Token Social Bit, the Page Pattern, and an Exercise for the Reader</a>
<ul class="sectlevel2">
<li><a href="https://www.obeythetestinggoat.com/book/chapter_page_pattern.html#_an_ft_with_multiple_users_and_addcleanup">25.1. An FT with Multiple Users, and addCleanup</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_page_pattern.html#_the_page_pattern">25.2. The Page Pattern</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_page_pattern.html#_extend_the_ft_to_a_second_user_and_the_my_lists_page">25.3. Extend the FT to a Second User, and the "My Lists" Page</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_page_pattern.html#_an_exercise_for_the_reader">25.4. An Exercise for the Reader</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_hot_lava.html">26. Fast Tests, Slow Tests, and Hot Lava</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/chapter_hot_lava.html#_thesis_unit_tests_are_superfast_and_good_besides_that">26.1. Thesis: Unit Tests Are Superfast and Good Besides That</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_hot_lava.html#_the_problems_with_pure_unit_tests">26.2. The Problems with "Pure" Unit Tests</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_hot_lava.html#_synthesis_what_do_we_want_from_our_tests_anyway">26.3. Synthesis: What Do We Want from Our Tests, Anyway?</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_hot_lava.html#_architectural_solutions">26.4. Architectural Solutions</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/chapter_hot_lava.html#_conclusion">26.5. Conclusion</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/epilogue.html">Appendix A: Obey the Testing Goat!</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/epilogue.html#_testing_is_hard">A.1. Testing Is Hard</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/epilogue.html#_remember_to_tip_the_bar_staff">A.2. Remember to Tip the Bar Staff</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/epilogue.html#_dont_be_a_stranger">A.3. Don’t Be a Stranger!</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_I_PythonAnywhere.html">Appendix B: PythonAnywhere</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/appendix_I_PythonAnywhere.html#_running_firefox_selenium_sessions_with_xvfb">B.1. Running Firefox Selenium Sessions with Xvfb</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_I_PythonAnywhere.html#_setting_up_django_as_a_pythonanywhere_web_app">B.2. Setting Up Django as a PythonAnywhere Web App</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_I_PythonAnywhere.html#_cleaning_up_tmp">B.3. Cleaning Up /tmp</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_I_PythonAnywhere.html#_screenshots">B.4. Screenshots</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_I_PythonAnywhere.html#_the_deployment_chapter">B.5. The Deployment Chapter</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_Django_Class-Based_Views.html">Appendix C: Django Class-Based Views</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/appendix_Django_Class-Based_Views.html#_class_based_generic_views">C.1. Class-Based Generic Views</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_Django_Class-Based_Views.html#_the_home_page_as_a_formview">C.2. The Home Page as a FormView</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_Django_Class-Based_Views.html#_using_form_valid_to_customise_a_createview">C.3. Using form_valid to Customise a CreateView</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_Django_Class-Based_Views.html#_a_more_complex_view_to_handle_both_viewing_and_adding_to_a_list">C.4. A More Complex View to Handle Both Viewing and Adding to a List</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_Django_Class-Based_Views.html#_compare_old_and_new">C.5. Compare Old and New</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_Django_Class-Based_Views.html#_best_practices_for_unit_testing_cbgvs">C.6. Best Practices for Unit Testing CBGVs?</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_III_provisioning_with_ansible.html">Appendix D: Provisioning with Ansible</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/appendix_III_provisioning_with_ansible.html#_installing_system_packages_and_nginx">D.1. Installing System Packages and Nginx</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_III_provisioning_with_ansible.html#_configuring_gunicorn_and_using_handlers_to_restart_services">D.2. Configuring Gunicorn, and Using Handlers to Restart Services</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_III_provisioning_with_ansible.html#_what_to_do_next">D.3. What to Do Next</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_IV_testing_migrations.html">Appendix E: Testing Database Migrations</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/appendix_IV_testing_migrations.html#_an_attempted_deploy_to_staging">E.1. An Attempted Deploy to Staging</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_IV_testing_migrations.html#_running_a_test_migration_locally">E.2. Running a Test Migration Locally</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_IV_testing_migrations.html#_inserting_a_data_migration">E.3. Inserting a Data Migration</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_IV_testing_migrations.html#_testing_the_new_migrations_together">E.4. Testing the New Migrations Together</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_IV_testing_migrations.html#_conclusions">E.5. Conclusions</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_bdd.html">Appendix F: Behaviour-Driven Development (BDD)</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/appendix_bdd.html#_what_is_bdd">F.1. What Is BDD?</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_bdd.html#_basic_housekeeping">F.2. Basic Housekeeping</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_bdd.html#_writing_an_ft_as_a_feature_using_gherkin_syntax">F.3. Writing an FT as a "Feature" Using Gherkin Syntax</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_bdd.html#_coding_the_step_functions">F.4. Coding the Step Functions</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_bdd.html#_first_step_definition">F.5. First Step Definition</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_bdd.html#_setup_and_teardown_equivalents_in_environment_py">F.6. setUp and tearDown Equivalents in environment.py</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_bdd.html#_another_run">F.7. Another Run</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_bdd.html#_capturing_parameters_in_steps">F.8. Capturing Parameters in Steps</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_bdd.html#_comparing_the_inline_style_ft">F.9. Comparing the Inline-Style FT</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_bdd.html#_bdd_encourages_structured_test_code">F.10. BDD Encourages Structured Test Code</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_bdd.html#_the_page_pattern_as_an_alternative">F.11. The Page Pattern as an Alternative</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_bdd.html#_bdd_might_be_less_expressive_than_inline_comments">F.12. BDD Might Be Less Expressive than Inline Comments</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_bdd.html#_will_nonprogrammers_write_tests">F.13. Will Nonprogrammers Write Tests?</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_bdd.html#_some_tentative_conclusions">F.14. Some Tentative Conclusions</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_rest_api.html">Appendix G: Building a REST API: JSON, Ajax, and Mocking with JavaScript</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/appendix_rest_api.html#_our_approach_for_this_appendix">G.1. Our Approach for This Appendix</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_rest_api.html#_choosing_our_test_approach">G.2. Choosing Our Test Approach</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_rest_api.html#_basic_piping">G.3. Basic Piping</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_rest_api.html#_actually_responding_with_something">G.4. Actually Responding with Something</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_rest_api.html#_adding_post">G.5. Adding POST</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_rest_api.html#_testing_the_client_side_ajax_with_sinon_js">G.6. Testing the Client-Side Ajax with Sinon.js</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_rest_api.html#_wiring_it_all_up_in_the_template_to_see_if_it_really_works">G.7. Wiring It All Up in the Template to See If It Really Works</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_rest_api.html#_implementing_ajax_post_including_the_csrf_token">G.8. Implementing Ajax POST, Including the CSRF Token</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_rest_api.html#_mocking_in_javascript">G.9. Mocking in JavaScript</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_rest_api.html#_data_validation_an_exercise_for_the_reader">G.10. Data Validation:  An Exercise for the Reader?</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_DjangoRestFramework.html">Appendix H: Django-Rest-Framework</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/chapter_page_pattern.html#_installation_2">H.1. Installation</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_DjangoRestFramework.html#_serializers_well_modelserializers_really">H.2. Serializers (Well, ModelSerializers, Really)</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_DjangoRestFramework.html#_viewsets_well_modelviewsets_really_and_routers">H.3. Viewsets (Well, ModelViewsets, Really) and Routers</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_DjangoRestFramework.html#_a_different_url_for_post_item">H.4. A Different URL for POST Item</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_DjangoRestFramework.html#_adapting_the_client_side">H.5. Adapting the Client Side</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_DjangoRestFramework.html#_what_django_rest_framework_gives_you">H.6. What Django-Rest-Framework Gives You</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_IX_cheat_sheet.html">Appendix I: Cheat Sheet</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/appendix_IX_cheat_sheet.html#_initial_project_setup">I.1. Initial Project Setup</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_IX_cheat_sheet.html#_the_basic_tdd_workflow">I.2. The Basic TDD Workflow</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_IX_cheat_sheet.html#_moving_beyond_dev_only_testing">I.3. Moving Beyond Dev-Only Testing</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_IX_cheat_sheet.html#_general_testing_best_practices">I.4. General Testing Best Practices</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_IX_cheat_sheet.html#_seleniumfunctional_testing_best_practices">I.5. Selenium/Functional Testing Best Practices</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_IX_cheat_sheet.html#_outside_in_test_isolation_versus_integrated_tests_and_mocking">I.6. Outside-In, Test Isolation Versus Integrated Tests, and Mocking</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_X_what_to_do_next.html">Appendix J: What to Do Next</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/appendix_X_what_to_do_next.html#_notificationsboth_on_the_site_and_by_email">J.1. Notifications—​Both on the Site and by Email</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_X_what_to_do_next.html#_switch_to_postgres">J.2. Switch to Postgres</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_X_what_to_do_next.html#_run_your_tests_against_different_browsers">J.3. Run Your Tests Against Different Browsers</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_X_what_to_do_next.html#_404_and_500_tests">J.4. 404 and 500 Tests</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_X_what_to_do_next.html#_the_django_admin_site">J.5. The Django Admin Site</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_X_what_to_do_next.html#_write_some_security_tests">J.6. Write Some Security Tests</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_X_what_to_do_next.html#_test_for_graceful_degradation">J.7. Test for Graceful Degradation</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_X_what_to_do_next.html#_caching_and_performance_testing">J.8. Caching and Performance Testing</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_X_what_to_do_next.html#_javascript_mvc_frameworks">J.9. JavaScript MVC Frameworks</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_X_what_to_do_next.html#_async_and_websockets">J.10. Async and Websockets</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_X_what_to_do_next.html#_switch_to_using_py_test">J.11. Switch to Using py.test</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_X_what_to_do_next.html#_check_out_coverage_py">J.12. Check Out coverage.py</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_X_what_to_do_next.html#_client_side_encryption">J.13. Client-Side Encryption</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_X_what_to_do_next.html#_your_suggestion_here">J.14. Your Suggestion Here</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_github_links.html">Appendix K: Source Code Examples</a>
<ul class="sectlevel2" style="display: none;">
<li><a href="https://www.obeythetestinggoat.com/book/appendix_github_links.html#_full_list_of_links_for_each_chapter">K.1. Full List of Links for Each Chapter</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_github_links.html#_using_git_to_check_your_progress">K.2. Using Git to Check Your Progress</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_github_links.html#_downloading_a_zip_file_for_a_chapter">K.3. Downloading a ZIP File for a Chapter</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/appendix_github_links.html#_dont_let_it_become_a_crutch">K.4. Don’t Let it Become a Crutch!</a></li>
</ul>
</li>
<li><a href="https://www.obeythetestinggoat.com/book/bibliography.html">Appendix L: Bibliography</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="chapter_page_pattern">The Token Social Bit, the Page Pattern, and an Exercise for the Reader</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Are
jokes about how "everything has to be social now" slightly old hat?
Everything has to be all A/B tested big data get-more-clicks lists of 10 Things
This Inspiring Teacher Said That Will Make You Change Your Mind About Blah Blah
now…​anyway. Lists, be they inspirational or otherwise, are often better
shared. Let’s allow our users to collaborate on their lists with other users.</p>
</div>
<div class="paragraph">
<p>Along the way we’ll improve our FTs by starting to implement something called
the Page object pattern.</p>
</div>
<div class="paragraph">
<p>Then, rather than showing you explicitly what to do, I’m going to let you write
your unit tests and application code by yourself.  Don’t worry, you won’t be
totally on your own!  I’ll give an outline of the steps to take, as well as
some hints and tips.</p>
</div>
<div class="sect2">
<h3 id="_an_ft_with_multiple_users_and_addcleanup">An FT with Multiple Users, and addCleanup</h3>
<div class="paragraph">
<p>Let’s
get started—​we’ll need two users for this FT:</p>
</div>
<div class="exampleblock sourcecode">
<div class="title">functional_tests/test_sharing.py (ch22l001)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> <span class="include">selenium</span> <span class="keyword">import</span> <span class="include">webdriver</span>
<span class="keyword">from</span> .base <span class="keyword">import</span> <span class="include">FunctionalTest</span>


<span class="keyword">def</span> <span class="function">quit_if_possible</span>(browser):
    <span class="keyword">try</span>: browser.quit()
    <span class="keyword">except</span>: <span class="keyword">pass</span>


<span class="keyword">class</span> <span class="class">SharingTest</span>(FunctionalTest):

    <span class="keyword">def</span> <span class="function">test_can_share_a_list_with_another_user</span>(<span class="predefined-constant">self</span>):
        <span class="comment"># Edith is a logged-in user</span>
        <span class="predefined-constant">self</span>.create_pre_authenticated_session(<span class="string"><span class="delimiter">'</span><span class="content">edith@example.com</span><span class="delimiter">'</span></span>)
        edith_browser = <span class="predefined-constant">self</span>.browser
        <span class="predefined-constant">self</span>.addCleanup(<span class="keyword">lambda</span>: quit_if_possible(edith_browser))

        <span class="comment"># Her friend Oniciferous is also hanging out on the lists site</span>
        oni_browser = webdriver.Firefox()
        <span class="predefined-constant">self</span>.addCleanup(<span class="keyword">lambda</span>: quit_if_possible(oni_browser))
        <span class="predefined-constant">self</span>.browser = oni_browser
        <span class="predefined-constant">self</span>.create_pre_authenticated_session(<span class="string"><span class="delimiter">'</span><span class="content">oniciferous@example.com</span><span class="delimiter">'</span></span>)

        <span class="comment"># Edith goes to the home page and starts a list</span>
        <span class="predefined-constant">self</span>.browser = edith_browser
        <span class="predefined-constant">self</span>.browser.get(<span class="predefined-constant">self</span>.live_server_url)
        <span class="predefined-constant">self</span>.add_list_item(<span class="string"><span class="delimiter">'</span><span class="content">Get help</span><span class="delimiter">'</span></span>)

        <span class="comment"># She notices a "Share this list" option</span>
        share_box = <span class="predefined-constant">self</span>.browser.find_element_by_css_selector(
            <span class="string"><span class="delimiter">'</span><span class="content">input[name="sharee"]</span><span class="delimiter">'</span></span>
        )
        <span class="predefined-constant">self</span>.assertEqual(
            share_box.get_attribute(<span class="string"><span class="delimiter">'</span><span class="content">placeholder</span><span class="delimiter">'</span></span>),
            <span class="string"><span class="delimiter">'</span><span class="content">your-friend@example.com</span><span class="delimiter">'</span></span>
        )</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The interesting feature to note about this section is the <code>addCleanup</code>
function, whose documentation you can find
<a href="https://docs.python.org/3/library/unittest.html#unittest.TestCase.addCleanup">online</a>.
It can be used as an alternative to the <code>tearDown</code> function as a way of
cleaning up resources used during the test.  It’s most useful when the resource
is only allocated halfway through a test, so you don’t have to spend time in
<code>tearDown</code> figuring out what does or doesn’t need cleaning up.</p>
</div>
<div class="paragraph">
<p><code>addCleanup</code> is run after <code>tearDown</code>, which is why we need that
<code>try/except</code> formulation for <code>quit_if_possible</code>; whichever of <code>edith_browser</code>
and <code>oni_browser</code> is also assigned to <code>self.browser</code> at the point at which the
test ends will already have been quit by the <code>tearDown</code> function.</p>
</div>
<div class="paragraph">
<p>We’ll also need to move <code>create_pre_authenticated_session</code> from
<em>test_my_lists.py</em> into <em>base.py</em>.</p>
</div>
<div class="paragraph">
<p>OK, let’s see if that all works:</p>
</div>
<div class="listingblock dofirst-ch22l002">
<div class="content">
<pre>$ <strong>python manage.py test functional_tests.test_sharing</strong>
[...]
Traceback (most recent call last):
  File "...python-tdd-book/functional_tests/test_sharing.py", line 31, in
test_can_share_a_list_with_another_user
[...]
selenium.common.exceptions.NoSuchElementException: Message: Unable to locate
element: input[name="sharee"]</pre>
</div>
</div>
<div class="paragraph">
<p>Great! It seems to have got through creating the two user sessions, and
it gets onto an expected failure—​there is no input for an email address
of a person to share a list with on the page.</p>
</div>
<div class="paragraph">
<p>Let’s do a commit at this point, because we’ve got at least a placeholder
for our FT, we’ve got a useful modification of the
<code>create_pre_authenticated_session</code> function, and we’re about to embark on
a bit of an FT refactor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git add functional_tests</strong>
$ <strong>git commit -m "New FT for sharing, move session creation stuff to base"</strong></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_page_pattern">The Page Pattern</h3>
<div class="paragraph">
<p>Before
we go any further, I want to show an alternative method for reducing
duplication in your FTs, called
<a href="http://bit.ly/2uWBvsM">"Page objects"</a>.</p>
</div>
<div class="paragraph">
<p>We’ve already built several helper methods for our FTs, including
<code>add_list_item</code>, which we’ve used here, but if we just keep adding more and
more, it’s going to get very crowded. I’ve worked on a base FT class that was
over 1,500 lines long, and that got pretty unwieldy.</p>
</div>
<div class="paragraph">
<p>Page objects are an alternative which encourage us to store all the information
and helper methods about the different types of pages on our site in a single place.
Let’s see how that might look for our site, starting with a class to represent any
lists page:</p>
</div>
<div class="exampleblock sourcecode small-code">
<div class="title">functional_tests/list_page.py</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> <span class="include">selenium.webdriver.common.keys</span> <span class="keyword">import</span> <span class="include">Keys</span>
<span class="keyword">from</span> .base <span class="keyword">import</span> <span class="include">wait</span>


<span class="keyword">class</span> <span class="class">ListPage</span>(<span class="predefined">object</span>):

    <span class="keyword">def</span> <span class="function">__init__</span>(<span class="predefined-constant">self</span>, test):
        <span class="predefined-constant">self</span>.test = test  <i class="conum" data-value="1"></i><b>(1)</b>


    <span class="keyword">def</span> <span class="function">get_table_rows</span>(<span class="predefined-constant">self</span>):  <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="keyword">return</span> <span class="predefined-constant">self</span>.test.browser.find_elements_by_css_selector(<span class="string"><span class="delimiter">'</span><span class="content">#id_list_table tr</span><span class="delimiter">'</span></span>)


    <span class="decorator">@wait</span>
    <span class="keyword">def</span> <span class="function">wait_for_row_in_list_table</span>(<span class="predefined-constant">self</span>, item_text, item_number):  <i class="conum" data-value="2"></i><b>(2)</b>
        expected_row_text = f<span class="string"><span class="delimiter">'</span><span class="content">{item_number}: {item_text}</span><span class="delimiter">'</span></span>
        rows = <span class="predefined-constant">self</span>.get_table_rows()
        <span class="predefined-constant">self</span>.test.assertIn(expected_row_text, [row.text <span class="keyword">for</span> row <span class="keyword">in</span> rows])


    <span class="keyword">def</span> <span class="function">get_item_input_box</span>(<span class="predefined-constant">self</span>):  <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="keyword">return</span> <span class="predefined-constant">self</span>.test.browser.find_element_by_id(<span class="string"><span class="delimiter">'</span><span class="content">id_text</span><span class="delimiter">'</span></span>)


    <span class="keyword">def</span> <span class="function">add_list_item</span>(<span class="predefined-constant">self</span>, item_text):  <i class="conum" data-value="2"></i><b>(2)</b>
        new_item_no = <span class="predefined">len</span>(<span class="predefined-constant">self</span>.get_table_rows()) + <span class="integer">1</span>
        <span class="predefined-constant">self</span>.get_item_input_box().send_keys(item_text)
        <span class="predefined-constant">self</span>.get_item_input_box().send_keys(Keys.ENTER)
        <span class="predefined-constant">self</span>.wait_for_row_in_list_table(item_text, new_item_no)
        <span class="keyword">return</span> <span class="predefined-constant">self</span>  <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>It’s initialised with an object that represents the current test.  That
gives us the ability to make assertions, access the browser instance via
<code>self.test.browser</code>, and use the <code>self.test.wait_for</code> function.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>I’ve copied across some of the existing helper methods from <em>base.py</em>, but
I’ve tweaked them slightly…​</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>For example, they make use of this new method.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Returning <code>self</code> is just a convenience. It enables
<a href="https://en.wikipedia.org/wiki/Method_chaining">method chaining</a>,
which we’ll see in action immediately.</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Let’s see how to use it in our test:</p>
</div>
<div class="exampleblock sourcecode">
<div class="title">functional_tests/test_sharing.py (ch22l004)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> .list_page <span class="keyword">import</span> <span class="include">ListPage</span>
[...]

        <span class="comment"># Edith goes to the home page and starts a list</span>
        <span class="predefined-constant">self</span>.browser = edith_browser
        <span class="predefined-constant">self</span>.browser.get(<span class="predefined-constant">self</span>.live_server_url)
        list_page = ListPage(<span class="predefined-constant">self</span>).add_list_item(<span class="string"><span class="delimiter">'</span><span class="content">Get help</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Let’s continue rewriting our test, using the Page object whenever
we want to access elements from the lists page:</p>
</div>
<div class="exampleblock sourcecode">
<div class="title">functional_tests/test_sharing.py (ch22l008)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">        <span class="comment"># She notices a "Share this list" option</span>
        share_box = list_page.get_share_box()
        <span class="predefined-constant">self</span>.assertEqual(
            share_box.get_attribute(<span class="string"><span class="delimiter">'</span><span class="content">placeholder</span><span class="delimiter">'</span></span>),
            <span class="string"><span class="delimiter">'</span><span class="content">your-friend@example.com</span><span class="delimiter">'</span></span>
        )

        <span class="comment"># She shares her list.</span>
        <span class="comment"># The page updates to say that it's shared with Oniciferous:</span>
        list_page.share_list_with(<span class="string"><span class="delimiter">'</span><span class="content">oniciferous@example.com</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We add the following three functions to our <code>ListPage</code>:</p>
</div>
<div class="exampleblock sourcecode">
<div class="title">functional_tests/list_page.py (ch22l009)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">    <span class="keyword">def</span> <span class="function">get_share_box</span>(<span class="predefined-constant">self</span>):
        <span class="keyword">return</span> <span class="predefined-constant">self</span>.test.browser.find_element_by_css_selector(
            <span class="string"><span class="delimiter">'</span><span class="content">input[name="sharee"]</span><span class="delimiter">'</span></span>
        )


    <span class="keyword">def</span> <span class="function">get_shared_with_list</span>(<span class="predefined-constant">self</span>):
        <span class="keyword">return</span> <span class="predefined-constant">self</span>.test.browser.find_elements_by_css_selector(
            <span class="string"><span class="delimiter">'</span><span class="content">.list-sharee</span><span class="delimiter">'</span></span>
        )


    <span class="keyword">def</span> <span class="function">share_list_with</span>(<span class="predefined-constant">self</span>, email):
        <span class="predefined-constant">self</span>.get_share_box().send_keys(email)
        <span class="predefined-constant">self</span>.get_share_box().send_keys(Keys.ENTER)
        <span class="predefined-constant">self</span>.test.wait_for(<span class="keyword">lambda</span>: <span class="predefined-constant">self</span>.test.assertIn(
            email,
            [item.text <span class="keyword">for</span> item <span class="keyword">in</span> <span class="predefined-constant">self</span>.get_shared_with_list()]
        ))</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The idea behind the Page pattern is that it should capture all the information
about a particular page in your site, so that if, later, you want to go and
make changes to that page—​even just simple tweaks to its HTML layout, for
example—​you have a single place to go to adjust your functional
tests, rather than having to dig through dozens of FTs.</p>
</div>
<div class="paragraph">
<p>The
next step would be to pursue the FT refactor through our other tests. I’m
not going to show that here, but it’s something you could do, for practice,
to get a feel for what the trade-offs between DRY and test readability
are like…​</p>
</div>
</div>
<div class="sect2">
<h3 id="_extend_the_ft_to_a_second_user_and_the_my_lists_page">Extend the FT to a Second User, and the "My Lists" Page</h3>
<div class="paragraph">
<p>Let’s
spec out just a little more detail of what we want our sharing user
story to be.  Edith has seen on her list page that the list is now "shared
with" Oniciferous, and then we can have Oni log in and see the list on his "My
Lists" page, maybe in a section called "lists shared with me":</p>
</div>
<div class="exampleblock sourcecode">
<div class="title">functional_tests/test_sharing.py (ch22l010)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> .my_lists_page <span class="keyword">import</span> <span class="include">MyListsPage</span>
[...]

        list_page.share_list_with(<span class="string"><span class="delimiter">'</span><span class="content">oniciferous@example.com</span><span class="delimiter">'</span></span>)

        <span class="comment"># Oniciferous now goes to the lists page with his browser</span>
        <span class="predefined-constant">self</span>.browser = oni_browser
        MyListsPage(<span class="predefined-constant">self</span>).go_to_my_lists_page()

        <span class="comment"># He sees Edith's list in there!</span>
        <span class="predefined-constant">self</span>.browser.find_element_by_link_text(<span class="string"><span class="delimiter">'</span><span class="content">Get help</span><span class="delimiter">'</span></span>).click()</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>That means another function in our <code>MyListsPage</code> class:</p>
</div>
<div class="exampleblock sourcecode">
<div class="title">functional_tests/my_lists_page.py (ch22l011)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">class</span> <span class="class">MyListsPage</span>(<span class="predefined">object</span>):

    <span class="keyword">def</span> <span class="function">__init__</span>(<span class="predefined-constant">self</span>, test):
        <span class="predefined-constant">self</span>.test = test


    <span class="keyword">def</span> <span class="function">go_to_my_lists_page</span>(<span class="predefined-constant">self</span>):
        <span class="predefined-constant">self</span>.test.browser.get(<span class="predefined-constant">self</span>.test.live_server_url)
        <span class="predefined-constant">self</span>.test.browser.find_element_by_link_text(<span class="string"><span class="delimiter">'</span><span class="content">My lists</span><span class="delimiter">'</span></span>).click()
        <span class="predefined-constant">self</span>.test.wait_for(<span class="keyword">lambda</span>: <span class="predefined-constant">self</span>.test.assertEqual(
            <span class="predefined-constant">self</span>.test.browser.find_element_by_tag_name(<span class="string"><span class="delimiter">'</span><span class="content">h1</span><span class="delimiter">'</span></span>).text,
            <span class="string"><span class="delimiter">'</span><span class="content">My Lists</span><span class="delimiter">'</span></span>
        ))
        <span class="keyword">return</span> <span class="predefined-constant">self</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Once again, this is a function that would be good to carry across into
<em>test_my_lists.py</em>, along with maybe a <code>MyListsPage</code> object.</p>
</div>
<div class="paragraph">
<p>In the meantime, Oniciferous can also add things to the list:</p>
</div>
<div class="exampleblock sourcecode">
<div class="title">functional_tests/test_sharing.py (ch22l012)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">    <span class="comment"># On the list page, Oniciferous can see says that it's Edith's list</span>
    <span class="predefined-constant">self</span>.wait_for(<span class="keyword">lambda</span>: <span class="predefined-constant">self</span>.assertEqual(
        list_page.get_list_owner(),
        <span class="string"><span class="delimiter">'</span><span class="content">edith@example.com</span><span class="delimiter">'</span></span>
    ))

    <span class="comment"># He adds an item to the list</span>
    list_page.add_list_item(<span class="string"><span class="delimiter">'</span><span class="content">Hi Edith!</span><span class="delimiter">'</span></span>)

    <span class="comment"># When Edith refreshes the page, she sees Oniciferous's addition</span>
    <span class="predefined-constant">self</span>.browser = edith_browser
    <span class="predefined-constant">self</span>.browser.refresh()
    list_page.wait_for_row_in_list_table(<span class="string"><span class="delimiter">'</span><span class="content">Hi Edith!</span><span class="delimiter">'</span></span>, <span class="integer">2</span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>That’s another addition to our <code>ListPage</code> object:</p>
</div>
<div class="exampleblock sourcecode">
<div class="title">functional_tests/list_page.py (ch22l013)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">class</span> <span class="class">ListPage</span>(<span class="predefined">object</span>):
    [...]

    <span class="keyword">def</span> <span class="function">get_list_owner</span>(<span class="predefined-constant">self</span>):
        <span class="keyword">return</span> <span class="predefined-constant">self</span>.test.browser.find_element_by_id(<span class="string"><span class="delimiter">'</span><span class="content">id_list_owner</span><span class="delimiter">'</span></span>).text</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It’s long past time to run the FT and check if all of this works!</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>python manage.py test functional_tests.test_sharing</strong>

    share_box = list_page.get_share_box()
    [...]
selenium.common.exceptions.NoSuchElementException: Message: Unable to locate
element: input[name="sharee"]</pre>
</div>
</div>
<div class="paragraph">
<p>That’s the expected failure; we don’t have an input for email addresses
of people to share with. Let’s do a commit:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git add functional_tests</strong>
$ <strong>git commit -m "Create Page objects for list pages, use in sharing FT"</strong></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_an_exercise_for_the_reader">An Exercise for the Reader</h3>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>I probably didn’t really understand what I was doing until after having
completed the "Exercise for the reader" in <a href="https://www.obeythetestinggoat.com/book/chapter_page_pattern.html#chapter_page_pattern">The Token Social Bit, the Page Pattern, and an Exercise for the Reader</a>.</p>
</div>
</blockquote>
<div class="attribution">
— Iain H. (reader)
</div>
</div>
<div class="paragraph">
<p>There’s
nothing that cements learning like taking the training wheels off,
and getting something working on your own, so I hope you’ll give this a go.</p>
</div>
<div class="paragraph">
<p>Here’s an outline of the steps you could take:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>We’ll need a new section in <em>list.html</em>, with, at first, a form with an
input box for an email address.  That should get the FT one step further.</p>
</li>
<li>
<p>Next, we’ll need a view for the form to submit to. Start by defining the
URL in the template, maybe something like <em>lists/&lt;list_id&gt;/share</em>.</p>
</li>
<li>
<p>Then, our first unit test. It can be just enough to get a placeholder view
in. We want the view to respond to POST requests, and it should respond with
a redirect back to the list page, so the test could be called something like
<code>ShareListTest.test_post_redirects_to_lists_page</code>.</p>
</li>
<li>
<p>We build out our placeholder view, as just a two-liner that finds a list and
redirects to it.</p>
</li>
<li>
<p>We can then write a new unit test which creates a user and a list,
does a POST with their email address, and checks that the user is added to
<code>list_.shared_with.all()</code> (a similar ORM usage to "My Lists").  That
<code>shared_with</code> attribute won’t exist yet; we’re going outside-in.</p>
</li>
<li>
<p>So before we can get this test to pass, we have to move down to the model
layer.  The next test, in <em>test_models.py</em>, can check that a list has a
<code>shared_with.add</code> method, which can be called with a user’s email address and
then check the lists' <code>shared_with.all()</code> queryset, which will subsequently
contain that user.</p>
</li>
<li>
<p>You’ll then need a <code>ManyToManyField</code>.  You’ll probably see an error message
about a clashing <code>related_name</code>, which you’ll find a solution to if you look
around the Django docs.</p>
</li>
<li>
<p>It will need a database migration.</p>
</li>
<li>
<p>That should get the model tests passing. Pop back up to fix the view test.</p>
</li>
<li>
<p>You may find the redirect view test fails, because it’s not sending a valid
POST request.  You can either choose to ignore invalid inputs, or adjust the
test to send a valid POST.</p>
</li>
<li>
<p>Then back up to the template level; on the "My Lists" page we’ll want a
<code>&lt;ul&gt;</code> with a <code>for</code> loop of the lists shared with the user. On the lists
page, we also want to show who the list is shared with, as well as
mention of who the list owner is. Look back at the FT for the correct classes
and IDs to use. You could have brief unit tests for each of these if you
like, as well.</p>
</li>
<li>
<p>You might find that spinning up the site with <code>runserver</code> will help you
iron out any bugs, as well as fine-tune the layout and aesthetics.
If you use a private browser session, you’ll be able to log multiple users
in.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>By the end, you might end up with something that looks like
<a href="https://www.obeythetestinggoat.com/book/chapter_page_pattern.html#list-sharing-example">Sharing lists</a>.</p>
</div>
<div id="list-sharing-example" class="imageblock">
<div class="content">
<img src="./The Token Social Bit, the Page Pattern, and an Exercise for the Reader_files/twp2_2501.png" alt="Screenshot of list sharing UI">
</div>
<div class="title">Figure 1. Sharing lists</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">The Page Pattern, and the Real Exercise for the Reader</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Apply DRY to your functional tests</dt>
<dd>
<p>    Once
your FT suite starts to grow, you’ll find that different tests will
    inevitably find themselves using similar parts of the UI. Try to avoid
    having constants, like the HTML IDs or classes of particular UI elements,
    duplicated between your FTs.</p>
</dd>
<dt class="hdlist1">The Page pattern</dt>
<dd>
<p>    Moving
helper methods into a base <code>FunctionalTest</code> class can become
    unwieldy.  Consider using individual Page objects to hold all the
    logic for dealing with particular parts of your site.</p>
</dd>
<dt class="hdlist1">An exercise for the reader</dt>
<dd>
<p>I hope you’ve actually tried this out!  Try to follow the outside-in
method, and occasionally try things out manually if you get stuck.
The real exercise for the reader, of course, is to apply TDD to your
next project.  I hope you’ll enjoy it!</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="paragraph">
<p>In the next chapter, we’ll wrap up with a discussion of testing "best
practices."</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-06-12 14:14:52 BST
</div>
</div>
<div class="comments" style="padding: 20px">
  <h3>Comments</h3>
  <div id="disqus_thread"><iframe id="dsq-app3202" name="dsq-app3202" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="./The Token Social Bit, the Page Pattern, and an Exercise for the Reader_files/saved_resource.html" style="width: 1px !important; min-width: 100% !important; border: none !important; overflow: hidden !important; height: 3273px !important;" horizontalscrolling="no" verticalscrolling="no"></iframe><iframe id="indicator-north" name="indicator-north" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" style="width: 1541px !important; border: none !important; overflow: hidden !important; top: 0px !important; min-width: 1541px !important; max-width: 1541px !important; position: fixed !important; z-index: 2147483646 !important; height: 19px !important; min-height: 19px !important; max-height: 19px !important; display: none !important;" src="./The Token Social Bit, the Page Pattern, and an Exercise for the Reader_files/saved_resource(1).html"></iframe><iframe id="indicator-south" name="indicator-south" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" style="width: 1541px !important; border: none !important; overflow: hidden !important; bottom: 0px !important; min-width: 1541px !important; max-width: 1541px !important; position: fixed !important; z-index: 2147483646 !important; height: 19px !important; min-height: 19px !important; max-height: 19px !important; display: none !important;" src="./The Token Social Bit, the Page Pattern, and an Exercise for the Reader_files/saved_resource(2).html"></iframe></div>
  <script type="text/javascript">
    var disqus_config = function () {
        this.page.identifier = 'chapter_page_pattern';
    };
    
    (function() {
        var d = document, s = d.createElement('script');
        s.src = '//obeythetestinggoat.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the &lt;a href="https://disqus.com/?ref_noscript" rel="nofollow"&gt;comments powered by Disqus.&lt;/a&gt;</noscript>
</div>

<script>   (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){   (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),   m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)   })(window,document,'script','//www.google-analytics.com/analytics.js','ga');    ga('create', 'UA-40928035-1', 'obeythetestinggoat.com');   ga('send', 'pageview');  </script>

<iframe style="display: none;" src="./The Token Social Bit, the Page Pattern, and an Exercise for the Reader_files/saved_resource(3).html"></iframe></body></html>